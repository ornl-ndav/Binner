/**
\page needs Needs


For neutron science experiments, the neutron density data accumulated on detectors are converted into the combination of Q-vector space and energy space, i.e. the four dimensional (Q, E) space. Q is a 1 by 3 vector. Conceptually, the binning process is very similar to the common operations of creating a histogram. The most straightforward implementation would be to consider neutron intensity to be accumulated on a size-less point, which can be "tossed" into bins. But in order to obtain perfect accuracy, particularly with the high resolution data capture capability of SNS, the critical difference in the rebinning routin is to voxelize parallelepiped cells, which are often very irregularly shaped, into a regular volume. Voxelization methods have been well studied in the field. 


It has been a notoriously hard problem in the field to "magically" choose the proper resolution for rebinning. Some efforts to adaptively vary binning resolution have been reported [Sanders01, Cappellari03, Bustinduy05]. Those methods are typically based on relative amount of errors present in neutron intensity measurements, and leads to using hierarchically organized data. While those methods have been shown to work they have generally been limited to 2D slices of the underlying 4D space, the problem space in the scope of this work is with the much more complex 4D space formed by Q-vector and energy. Those 2D based methods do not necessarily apply. In addition, those multi-resolution methods were all studied regarding a single piece of experimental data (i.e. from a single sample orientation angle, and a constant external condition). SNS offers the capability to finish much more complex experiment in a timely manner and makes it possible to vary sample orientation and other external conditions on a continuous basis. This leads to a completely unprecedented use case, where after hundreds of experiment runs of independent grids are coalesced together into one common grid via rebinning, grid cells will have correspondingly hundreds of disparate relative error measurements. Clearly previous adaptive resolution methods cannot be applied with SNS data.

A goal of this entire analysis pipeline that starts with rebinning, for example, is to effectively determine intrinsic fine scale structures (e.g. micrometer to atomic scales) of critical importance to application sciences to model new alloy material or key protein compounds, especially how such structures vary under perturbed external conditions such as temperature, magnetic fields and complex chemical/physical processes. No existing experimental systems can support studies geared towards such a grand goal. While this proposal's computational research is focused on defining new patterns for successful exascale computing, it will also realize an ambitious plan to fill a recognized void in the analysis, perception, and understanding of experimental data that is becoming crucial as next generation neutron sources deliver more and more data in more detail.

The input is already quite data intensive -- more than 250 bytes per cell. Today's datasets from SNS experimental tests already have more than 1 billion cells. Due to the way the physics code computes space transformation and the community-wide data format standards, little between-cell savings can be constructed when storing the data. The Rebinner package uses a streaming model to make the most of pipeline base parallelism and also use an in-house implementation of map-reduce for SPMD type of parallelism. The output data of the rebinner is in essence a regularized volume that may be very sparse, or dense (depending on the type of experiment). When analyzing experiment data, users select runs of different orientations and rebin onto a grid of 1000 cube in h, k, l space just to inspect whether regular crystal structures exist. Users can vary this trial and error process further by temperature, or by magnetic field or other conditions. If interesting structures are discovered, users will need to zoom in onto the area around the structure and re-compute the rebin process.

Previous systems when dealing with similar datasets will require hours of processing before producing any results. Rebinner's execution is highly optimized and is only limited by its outbound bandwidth. The overall performance for an iterative rebinning process can be as short as 2 to 5 minutes, generating large volumes of 1000 cube resolution from input data of up to 200 GB of input cell geometry. 

*/

